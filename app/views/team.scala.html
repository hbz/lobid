@* Copyright 2017 Fabian Steeg, hbz. Licensed under the Eclipse Public License 1.0 *@

@(json: play.api.libs.json.JsValue)

@import play.api.libs.json._

@text(key: String) = {
	@Html((json\key\controllers.Application.currentLang).asOpt[String].getOrElse("--"))
}

@currentLabel(member: JsValue) = {
	@if((member \ "member" \ "image").asOpt[String].isDefined){
		<img src='@((member \ "member" \ "image").as[String])' width="50" style="float:left; padding:5px" />
	}
	<div>
		<p>
			<a target="_blank" rel="nofollow" href='@((member \ "member" \ "id").asOpt[String])'>@((member \ "member" \ "name").as[String])</a> <br/>
			@((member \ "roleName" \ controllers.Application.currentLang).as[String]) <br/>
		</p>
	</div>
}

@formerLabel(member: JsValue) = {
	<div>
		<p>
			@((member \ "member" \ "name").as[String]) <br/>
			@((member \ "roleName" \ controllers.Application.currentLang).as[String]) <br/>
		</p>
	</div>
}

@wrapper("lobid - team"){
	<h1>@text("name") <small><a title="Beschreibung als JSON-LD anzeigen" href='@routes.LobidTeam.teamDotFormat("json")'><img class='json-ld-icon' src='@routes.Assets.at("/public","images/json-ld.png")'></a></small></h1>

	<p class="lead">@text("description")</p>

	<p>@for(contact <- (json \ "contactPoint").as[Seq[JsValue]]) {
		<a target="_blank" rel="nofollow" href='@((contact \ "id").as[String])'><img src='@((contact \ "image").as[String])' height="20" title='@((contact \ "contactType" \ controllers.Application.currentLang).as[String])'/></a>
		&nbsp;
	}</p>

	<h2>@Messages("team.members")</h2>
	@defining((json \ "member").as[Seq[JsValue]] partition ((j: JsValue) => !((j \ "endDate").asOpt[String].isDefined))) { case (current, former) =>
		@for(member <- current) {
			@currentLabel(member)
		}
		<h3>@Messages("team.members.former") <small><a id="showFormer" href="#" onclick="$('#former').show();$('#showFormer').hide();return false;"><span class="glyphicon glyphicon-plus-sign"></span></a></small></h3>
		<div id="former" style="display:none">
			@for(member <- former) {
				@formerLabel(member)
			}
		</div>
	}

	<h2>@Messages("team.products")</h2>
	@for(offer <- (json \ "makesOffer").as[Seq[JsValue]]) {
		<p><a target="_blank" rel="nofollow" href='@((offer \ "id").as[String])'>@((offer \ "name").as[String])</a><br/>
		@if(((offer \ "alternateName").asOpt[JsValue]).isDefined){@((offer \ "alternateName" \ controllers.Application.currentLang).as[String])}</p>
	}
}